import folium
import pandas as pd
import matplotlib.pyplot as plt

# Lecture des données
data = pd.read_csv("experimentations_5G.csv", sep=";", encoding="cp1252", usecols=["Expérimentateur", "Bande de fréquences", "Latitude", "Longitude", "Commune", "Code INSEE", "Région"])

# Remplir les valeurs manquantes par 0
data = data.fillna(0)

# Partie carte de la France et des antennes 5G
data["Latitude"] = data["Latitude"].astype(str).str.replace(",", ".").astype(float)
data["Longitude"] = data["Longitude"].astype(str).str.replace(",", ".").astype(float)

# Initialisation de la carte centrée sur la France
france = folium.Map(location=[45.6, 3.351828], zoom_start=6)

# Ajout des markers pour chaque antenne
for _, row in data.iterrows():
    if row["Bande de fréquences"] == "26 GHz":
        colorping = "green"
    elif row["Bande de fréquences"] == "3,8 GHz":
        colorping = "orange"
    elif row["Bande de fréquences"] == "2,6 GHz TDD":
        colorping = "red"
    
    folium.Marker(
        location=[row["Latitude"], row["Longitude"]],
        tooltip=["Cliquez-ici ! Commune : ", row["Commune"], " Code INSEE : ", row["Code INSEE"]],
        popup=["Les Expérimentateurs : ", row["Expérimentateur"], " Et les bandes de fréquences : ", row["Bande de fréquences"]],
        icon=folium.Icon(color=colorping),
    ).add_to(france)

# Ajout de la légende à gauche de la carte avec un div HTML
legend_html = """
    <div style="position: fixed; 
                bottom: 50px; left: 10px; width: 160px; height: 120px; 
                background-color: white; border:2px solid grey; z-index:9999; 
                font-size: 14px; padding: 10px;">
        <b>Légende des bandes de fréquence</b><br>
        <i style="background-color: green; width: 20px; height: 20px; display: inline-block;"></i> 26 GHz<br>
        <i style="background-color: orange; width: 20px; height: 20px; display: inline-block;"></i> 3,8 GHz<br>
        <i style="background-color: red; width: 20px; height: 20px; display: inline-block;"></i> 2,6 GHz TDD
    </div>
"""
# Ajout de la légende dans la carte avec le HTML
france.get_root().html.add_child(folium.Element(legend_html))

# Afficher la carte
france
